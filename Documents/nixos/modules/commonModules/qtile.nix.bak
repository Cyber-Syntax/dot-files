{ pkgs, ... }:

{


systemd.user.targets.qtile-session = {
    description = "Qtile compositor session";
    documentation = [ "man:systemd.special(7)" ];
    bindsTo = [ "graphical-session.target" ];
    wants = [ "graphical-session-pre.target" ];
    after = [ "graphical-session-pre.target" ];
  };

  services = { # lightdm, qtile, xserver
    displayManager = {
      defaultSession = "qtile";
      # unstable work with this on x11 
      # sessions-directory = /nix/store/vkwfxdca6z8hh3zwrd7xd487wr16z0wl-desktops/share/xsessions:/nix/store/vkwfxdca6z8hh3zwrd7xd487wr16z0wl-desktops/share/wayland-sessions
     autoLogin.enable = true;  #NOTE: ctrl + alt + F1,2,3,4 still works
     autoLogin.user = "developer";

    # sddm because lightdm cause issue on 24.05
      sddm = {
        enable = true;
        autoNumlock = true;
      };
    };
    
    xserver = {
      enable = true;
      xkb.layout = "tr";
      autorun = true;
      exportConfiguration = true;

      displayManager = { # Lightdm
       # lightdm.enable = true;
        session = [ 
          { 
            manage = "desktop";
            name = "qtile";
            start = ''
              exec qtile start &
              waitPID=$!
            '';
          }
        ];

        # # [Seat:*]
        # lightdm.extraConfig = ''
        #   greeter-setup-script=/usr/bin/setxkbmap -layout tr
        #   logind-check-graphical=true
        #   '';
      };

      windowManager.qtile = { 
        enable = true;
        #backend = "x11"; #24.05 old removed on 24.11
#NOTE: If something going wrong on unstable we can pin the old 
#        version like qtile and continue with other packages to update
#TEST: lets continue with unstable?
        # This one symlink only config.py instead of all the other files inside qtile folder.   
        #configFile = /home/developer/Documents/nixos/hosts/desktop/qtile;
#BUG: qtile_extras not found problem on stable branch
#TESTING: Probably new qtile version can be fix this issue. Overlay would be work?
         extraPackages = python3Packages: with python3Packages; [
            qtile-extras
          ];
      };
      
    }; #./xserver
  }; ### ./services
}
